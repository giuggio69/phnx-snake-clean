<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>PHNX Snake — Clean</title>
  <style>
    :root { --bg:#0b0b10; --panel:#11111a; --text:#eaeaf2; --muted:#a5a5c7; --accent:#ff3b6b; }
    html,body{height:100%; margin:0; background:var(--bg); color:var(--text); font-family: ui-sans-serif, -apple-system, system-ui, Segoe UI, Roboto, Arial;}
    body{display:flex; align-items:center; justify-content:center; padding:16px; overscroll-behavior:none; touch-action:none; -webkit-user-select:none; user-select:none;}
    .wrap{width:min(720px, 100%); display:grid; gap:14px; grid-template-columns: 1fr; }
    .top{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:14px 16px; border-radius:18px;
      background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      border:1px solid rgba(255,255,255,0.10);
      box-shadow: 0 14px 40px rgba(0,0,0,0.35);
    }
    .title{font-weight:900; letter-spacing:0.6px;}
    .meta{color:var(--muted); font-size:13px; margin-top:2px;}
    .pill{padding:8px 10px; border-radius:999px; border:1px solid rgba(255,59,107,0.35); background:rgba(255,59,107,0.10); font-weight:800; font-size:12px;}
    .card{position:relative; border-radius:20px; overflow:hidden;
      background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.10);
      box-shadow: 0 14px 40px rgba(0,0,0,0.35);
      padding:14px;
    }
    .row{display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:space-between;}
    .stat{padding:10px 12px; border-radius:14px; border:1px solid rgba(255,255,255,0.10); background:rgba(0,0,0,0.18); min-width:120px;}
    .stat .k{color:var(--muted); font-size:12px;}
    .stat .v{font-size:22px; font-weight:900; margin-top:2px;}
    .canvasWrap{display:flex; justify-content:center; padding:10px 0 2px;}
    canvas{width:min(640px, 92vw); height:auto; aspect-ratio:1/1; background:#05050a; border-radius:18px; border:1px solid rgba(255,255,255,0.10); touch-action:none;}
    .overlay{position:absolute; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none;}
    .overlay .box{padding:12px 14px; border-radius:16px; border:1px solid rgba(255,255,255,0.14);
      background:rgba(0,0,0,0.35); font-weight:900; letter-spacing:0.5px;}
    .help{color:var(--muted); font-size:13px; line-height:1.4; margin-top:10px;}
    .btnRow{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;}
    button{appearance:none; border:1px solid rgba(255,255,255,0.14); background:rgba(0,0,0,0.20);
      color:var(--text); padding:10px 12px; border-radius:14px; font-weight:900; cursor:pointer;}
    button.primary{border-color: rgba(255,59,107,0.55); background:rgba(255,59,107,0.14);}
    button:active{transform:translateY(1px);}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div>
        <div class="title">PHNX • SNAKE (CLEAN v1)</div>
        <div class="meta">Funziona su PC + telefono (tap + swipe). Nessuna dipendenza.</div>
      </div>
      <div class="pill">TARGET: 30 punti → sconto</div>
    </div>

    <div class="card">
      <div class="row">
        <div class="stat"><div class="k">Punteggio</div><div class="v" id="score">0</div></div>
        <div class="stat"><div class="k">Record</div><div class="v" id="best">0</div></div>
        <div class="stat"><div class="k">Livello</div><div class="v" id="level">1</div></div>
      </div>

      <div class="canvasWrap">
        <div style="position:relative;">
          <canvas id="c" width="640" height="640"></canvas>
          <div class="overlay" id="overlay"><div class="box" id="overlayText">TAP / CLICK TO START</div></div>
        </div>
      </div>

      <div class="btnRow">
        <button class="primary" id="startBtn">Start</button>
        <button id="pauseBtn">Pause</button>
        <button id="resetBtn">Reset</button>
      </div>

      <div class="help">
        PC: Frecce o WASD. <br/>
        Telefono: tocca per iniziare, poi swipe (su/giù/destra/sinistra). <br/>
        Regola: non toccare muri o te stesso.
      </div>
    </div>
  </div>

<script>
(() => {
  // preload PHNX logo for food
  const phnxLogo = new Image();
  phnxLogo.src = "logo_phnx.png";

  const canvas = document.getElementById("c");
  const ctx = canvas.getContext("2d");

  const scoreEl = document.getElementById("score");
  const bestEl = document.getElementById("best");
  const levelEl = document.getElementById("level");
  const overlay = document.getElementById("overlay");
  const overlayText = document.getElementById("overlayText");

  const startBtn = document.getElementById("startBtn");
  const pauseBtn = document.getElementById("pauseBtn");
  const resetBtn = document.getElementById("resetBtn");

  const GRID = 18;
  const BG = "#05050a";
  const GRID_STROKE = "rgba(255,255,255,0.16)";
  const SNAKE_HEAD = "rgba(255,59,107,0.95)";
  const SNAKE_BODY = "rgba(255,59,107,0.55)";
  const FOOD = "rgba(0,245,212,0.95)";

  let snake, dir, nextDir, food, running=false, paused=false, score=0, best=0, level=1;
  let tickMsBase = 150;
  let lastTick = 0;

  function randCell() {
    return { x: Math.floor(Math.random()*GRID), y: Math.floor(Math.random()*GRID) };
  }
  function same(a,b){ return a.x===b.x && a.y===b.y; }

  function placeFood(){
    let f;
    do { f = randCell(); } while (snake.some(s=>same(s,f)));
    food = f;
  }

  function resetGame(){
    snake = [{x: Math.floor(GRID/2), y: Math.floor(GRID/2)}];
    dir = {x:1, y:0};
    nextDir = {x:1, y:0};
    score = 0;
    level = 1;
    placeFood();
    running = false;
    paused = false;
    updateUI();
    showOverlay("TAP / CLICK TO START");
    draw();
  }

  function updateUI(){
    scoreEl.textContent = String(score);
    bestEl.textContent = String(best);
    levelEl.textContent = String(level);
  }

  function showOverlay(text){
    overlayText.textContent = text;
    overlay.style.display = "flex";
  }
  function hideOverlay(){ overlay.style.display = "none"; }

  function setDir(x,y){
    if (running){
      if (x === -dir.x && y === -dir.y) return;
    }
    nextDir = {x,y};
  }

  function start(){
    if (!running){
      running = true;
      paused = false;
      lastTick = performance.now();
      hideOverlay();
    }
  }

  function pauseToggle(){
    if (!running) return;
    paused = !paused;
    if (paused) showOverlay("PAUSED");
    else hideOverlay();
  }

  function gameOver(){
    running = false;
    paused = false;
    best = Math.max(best, score);
    updateUI();
    showOverlay("GAME OVER — TAP TO RESTART");
    setTimeout(() => {
      resetGame();
      showOverlay("GAME OVER — TAP TO RESTART");
    }, 250);
  }

  function step(){
    dir = nextDir;
    const head = snake[0];
    const nh = {x: head.x + dir.x, y: head.y + dir.y};

    if (nh.x < 0 || nh.y < 0 || nh.x >= GRID || nh.y >= GRID) return gameOver();
    if (snake.some(s=>same(s, nh))) return gameOver();

    snake.unshift(nh);

    if (same(nh, food)){
      score += 1;
      if (score % 10 === 0) level += 1;
      placeFood();
    } else {
      snake.pop();
    }

    best = Math.max(best, score);
    updateUI();
  }

  function drawGrid(){
    ctx.fillStyle = BG;
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.strokeStyle = GRID_STROKE;
    ctx.lineWidth = 1;
    const CELL = canvas.width / GRID;
    for (let i=0;i<=GRID;i++){
      ctx.beginPath(); ctx.moveTo(i*CELL, 0); ctx.lineTo(i*CELL, canvas.height); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(0, i*CELL); ctx.lineTo(canvas.width, i*CELL); ctx.stroke();
    }
  }

  function draw(){
    const CELL = canvas.width / GRID;
    drawGrid();

    // food = PHNX LOGO
    const fx = food.x * CELL;
    const fy = food.y * CELL;
    const size = CELL * 0.8;
    const offset = (CELL - size) / 2;

    if (phnxLogo.complete && phnxLogo.naturalWidth > 0) {
      ctx.drawImage(phnxLogo, fx + offset, fy + offset, size, size);
    } else {
      ctx.fillStyle = FOOD;
      ctx.beginPath();
      ctx.arc(fx + CELL/2, fy + CELL/2, CELL * 0.22, 0, Math.PI * 2);
      ctx.fill();
    }

    // snake
    for (let i=0;i<snake.length;i++){
      const s = snake[i];
      ctx.fillStyle = (i===0) ? SNAKE_HEAD : SNAKE_BODY;
      ctx.fillRect(s.x*CELL+2, s.y*CELL+2, CELL-4, CELL-4);
    }
  }

  function loop(now){
    requestAnimationFrame(loop);
    draw();

    if (!running || paused) return;

    const speed = Math.max(60, tickMsBase - (level-1)*10);
    if (now - lastTick >= speed){
      lastTick = now;
      step();
    }
  }

  window.addEventListener("keydown", (e) => {
    const k = e.key.toLowerCase();
    if (k === "arrowup" || k === "w") setDir(0,-1);
    else if (k === "arrowdown" || k === "s") setDir(0,1);
    else if (k === "arrowleft" || k === "a") setDir(-1,0);
    else if (k === "arrowright" || k === "d") setDir(1,0);
    else if (k === " "){
      if (!running) start();
      else pauseToggle();
    }
  });

  startBtn.addEventListener("click", () => start());
  pauseBtn.addEventListener("click", () => pauseToggle());
  resetBtn.addEventListener("click", () => resetGame());

  let sx=null, sy=null;
  canvas.addEventListener("touchstart", (e) => {
    const t = e.touches && e.touches[0];
    if (!t) return;
    sx = t.clientX; sy = t.clientY;
    if (!running) start();
  }, {passive:true});

  canvas.addEventListener("touchmove", (e) => {
    if (sx===null || sy===null) return;
    const t = e.touches && e.touches[0];
    if (!t) return;
    const dx = t.clientX - sx;
    const dy = t.clientY - sy;
    const ax = Math.abs(dx), ay = Math.abs(dy);
    if (ax < 14 && ay < 14) return;

    e.preventDefault();
    if (ax > ay) setDir(dx>0 ? 1 : -1, 0);
    else setDir(0, dy>0 ? 1 : -1);

    sx = t.clientX; sy = t.clientY;
  }, {passive:false});

  canvas.addEventListener("touchend", () => { sx=null; sy=null; }, {passive:true});

  canvas.addEventListener("pointerdown", () => {
    if (!running) start();
    else if (paused) pauseToggle();
  });

  try{
    resetGame();
    requestAnimationFrame(loop);
  } catch(err){
    showOverlay("ERRORE: " + err.message);
    console.error(err);
  }
})();
</script>
</body>
</html>
